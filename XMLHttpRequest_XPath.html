<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>test requète XPath</title>
    <!--lien vers le CSS de la page-->
    <link rel="stylesheet" href="StylePersonaXML.css" />
    <!--icone de la page-->
    <link rel="icon" href="Image/icon.gif">
</head>

<body onload="setJackSize();">
    <!--image de décoration-->
    <img src="Image/jackfrost2.png" id="JackFrost2">
    <!--menu de navigation entre les pages-->
    <nav>
        <!--titre du menu de navigation-->
        <h3>Menu de navigation :</h3>
        <!--lien vers la page de sélection de réalisateur-->
        <a href="SelectionReal">Selection réalisateur</a>
        <!--lien vers la page d'index-->
        <a href="index">HTTP request</a>
    </nav>

    <!--div de titre-->
    <div id="DivTitre">
        <!--image de décoration-->
        <img src="Image/JackFrost.png" class="JackFrost" style="display: inline;">
        <!--titre principal de la page-->
        <h1 id="MainTitle" style="display:inline">Test de requète HTTP</h1>
        <!--image de décoration-->
        <img src="Image/JackFrost.png" class="JackFrost">
    </div>

    <!--sous-titre-->
    <h2>Tableau de films</h2>
    <!--div contenant un tableau avec les informations des films-->
    <div id="test">

    </div>

    <!--div contenant différent test de HTTPRequest-->
    <div id="MonTest" style="color:white">
        <!--sous-titre-->
        <h2>Récupération des titres de films sortie après 1900</h2>
        <!--div contenant les titres des films sortie après 1900-->
        <div id="titleList1900" style="border:solid 2px white; background-color:black; width:50%; margin-left:25%;">

        </div>
        <!--sous-titre-->
        <h2>Récupération du titre du premier film de la liste</h2>
        <!--div contenant le permier film de la liste-->
        <div id="firstFilm" style="border:solid 2px white; background-color:black; width:50%; margin-left:25%;">

        </div>
        <!--sous-titre-->
        <h2>Récupération du titre du dernier film de la liste</h2>
        <!--div contenant le dernier film de la liste-->
        <div id="lastFilm" style="border:solid 2px white; background-color:black; width:50%; margin-left:25%;">

        </div>
        <!--sous-titre-->
        <h2>Récupération des titres de films sortie après 1950</h2>
        <!--div contenant les titres des films sortie après 1950-->
        <div id="titleList1950" style="border:solid 2px white; background-color:black; width:50%; margin-left:25%;">

        </div>
    </div>

    <script>

        //permet de changer la taille des images de déco du titre
        function setJackSize() {
            //récupération des images
            var mesJacks = document.getElementsByClassName("JackFrost");
            //récupération de la hauteur du titre
            var monTitreHeight = document.getElementById("MainTitle").offsetHeight;
            //pour chaque image
            for (var i = 0; i < mesJacks.length; i++) {
                //modification de la hauteur maximale des images
                mesJacks[i].style.maxHeight = monTitreHeight + "px";
            }
        }

        //variable de type XMLHttpRequest
        var xhttp = new XMLHttpRequest;

        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                showResult(xhttp.responseXML);
            }
        };

        //ouverture du fichier XML
        xhttp.open("GET", "MesFilms.xml", true);
        //envoi de la requète
        xhttp.send();

        function showResult(xml) {
            //création d'un div servant de tableau
            var tableau = document.createElement("div");
            //création de divs servant de colonne pour le tableau
            var col1 = document.createElement("div");
            var col2 = document.createElement("div");
            var col3 = document.createElement("div");
            //ajout de l'attribut class pour les colonnes du tableau
            col1.setAttribute("class", "divtab");
            col2.setAttribute("class", "divtab");
            col3.setAttribute("class", "divtab");

            //création des variables qui serviront de lignes du tableau
            var ligneCol1 = document.createElement('p');
            ligneCol1.setAttribute("class", "case");
            var ligneCol2 = document.createElement('p');
            ligneCol2.setAttribute("class", "case");
            var ligneCol3 = document.createElement('p');
            ligneCol3.setAttribute("class", "case");

            //initialisation des premières lignes du tableau
            ligneCol1.innerHTML = "Film";
            ligneCol2.innerHTML = "Réal";
            ligneCol3.innerHTML = "Date";

            //ajout des premières lignes dans les colonnes du tableau
            col1.appendChild(ligneCol1);
            col2.appendChild(ligneCol2);
            col3.appendChild(ligneCol3);

            //création d'un tableau contenant la liste des titres
            var titleList = new Array;
            //création d'un tableau contenant la liste des réal
            var realList = new Array;
            //création d'un tableau contenant la liste des date
            var dateList = new Array;

            //création d'un path pour vers les titres de films
            var path = "lesfilms/film/titre";

            //si le xml existe et est correct
            if (xml.evaluate) {
                //récupération des nodes via le path et le fichier xml
                var nodes = xml.evaluate(path, xml, null, XPathResult.ANY_TYPE, null);
                //récupération de la première itération
                var result = nodes.iterateNext();
                //tant qu'il y a un résultat
                while (result) {
                    //ajout du titre à la liste de titre
                    titleList.push(result.childNodes[0].nodeValue);
                    //passage à la prochaine itération
                    result = nodes.iterateNext();
                }
            }
            //si IE
            else if (window.ActiveXObject || xhttp.responseType == "msxml-document") {
                //définition de la propriété SelectionLanguage
                xml.setProperty("SelectionLanguage", "XPath");
                //récupération des nodes via le path et le fichier xml
                nodes = xml.selectNodes(path);
                //pour chaque résultat
                for (var i = 0; i < nodes.length; i++) {
                    //ajout du titre à la liste de titre
                    titleList.push(nodes[i].childNodes[0].nodeValue);
                }
            }

            //création d'un path pour vers les réalisateurs de films
            path = "lesfilms/film/realisateur";

            //si le xml existe et est correct
            if (xml.evaluate) {
                //récupération des nodes via le path et le fichier xml
                var nodes = xml.evaluate(path, xml, null, XPathResult.ANY_TYPE, null);
                //récupération de la première itération
                var result = nodes.iterateNext();
                //tant qu'il y a un résultat
                while (result) {
                    //ajout du réalisateur à la liste de réalisateur
                    realList.push(result.childNodes[0].nodeValue);
                    //passage à la prochaine itération
                    result = nodes.iterateNext();
                }
            }
            //si IE
            else if (window.ActiveXObject || xhttp.responseType == "msxml-document") {
                //définition de la propriété SelectionLanguage
                xml.setProperty("SelectionLanguage", "XPath");
                //récupération des nodes via le path et le fichier xml
                nodes = xml.selectNodes(path);
                //pour chaque résultat
                for (var i = 0; i < nodes.length; i++) {
                    //ajout du réalisateur à la liste de réalisateur
                    realList.push(nodes[i].childNodes[0].nodeValue);
                }
            }

            //création d'un path pour vers les dates de films
            path = "lesfilms/film/date";

            //si le xml existe et est correct
            if (xml.evaluate) {
                //récupération des nodes via le path et le fichier xml
                var nodes = xml.evaluate(path, xml, null, XPathResult.ANY_TYPE, null);
                //récupération de la première itération
                var result = nodes.iterateNext();
                //tant qu'il y a un résultat
                while (result) {
                    //ajout de la date à la liste de dates
                    dateList.push(result.childNodes[0].nodeValue);
                    //passage à la prochaine itération
                    result = nodes.iterateNext();
                }
            }
            //si IE
            else if (window.ActiveXObject || xhttp.responseType == "msxml-document") {
                //définition de la propriété SelectionLanguage
                xml.setProperty("SelectionLanguage", "XPath");
                //récupération des nodes via le path et le fichier xml
                nodes = xml.selectNodes(path);
                //pour chaque résultat
                for (var i = 0; i < nodes.length; i++) {
                    //ajout de la date à la liste de dates
                    dateList.push(nodes[i].childNodes[0].nodeValue);
                }
            }
            //pour chaque film
            for (var cpt = 0; cpt < titleList.length; cpt++) {
                //création des lignes du tableau
                ligneCol1 = document.createElement('p');
                ligneCol1.setAttribute("class", "case");
                ligneCol2 = document.createElement('p');
                ligneCol2.setAttribute("class", "case");
                ligneCol3 = document.createElement('p');
                ligneCol3.setAttribute("class", "case");
                //ajout du texte des lignes
                ligneCol1.innerHTML = titleList[cpt];
                ligneCol2.innerHTML = realList[cpt];
                ligneCol3.innerHTML = dateList[cpt];
                //ajout des lignes dans les colonnes
                col1.appendChild(ligneCol1);
                col2.appendChild(ligneCol2);
                col3.appendChild(ligneCol3);
            }
            //mise à jour du tableau
            tableau.appendChild(col1);
            tableau.appendChild(col2);
            tableau.appendChild(col3);

            //ajout du tableau dans la page
            document.getElementById("test").appendChild(tableau);

            //création d'un path cherchant les titre de film sortie après 1900
            path = "lesfilms/film[date>1900]/titre";
            //création de la chaine récupérant la liste de ces films
            var tmpString = "";

            //si le xml existe et est correct
            if (xml.evaluate) {
                //récupération des nodes via le path et le fichier xml
                var nodes = xml.evaluate(path, xml, null, XPathResult.ANY_TYPE, null);
                //récupération de la première itération
                var result = nodes.iterateNext();
                //tant qu'il y a un résultat
                while (result) {
                    //ajout du titre à la chaine
                    tmpString += result.childNodes[0].nodeValue + "\n";
                    //passage à la prochaine itération
                    result = nodes.iterateNext();
                }
            }
            //si IE
            else if (window.ActiveXObject || xhttp.responseType == "msxml-document") {
                //définition de la propriété SelectionLanguage
                xml.setProperty("SelectionLanguage", "XPath");
                //récupération des nodes via le path et le fichier xml
                nodes = xml.selectNodes(path);
                //pour chaque résultat
                for (var i = 0; i < nodes.length; i++) {
                    //ajout du titre à la chaine
                    tmpString += result.childNodes[0].nodeValue+"<br/>";
                }
            }
            //affichage du résultat
            console.log("Liste des films sortie après 1900");
            console.log(tmpString);
            document.getElementById("titleList1900").innerHTML = tmpString;

            //création d'un path pour vers les titres de films
            path = "lesfilms/film/titre";
            //reset de la chaine
            tmpString="";

            //si le xml existe et est correct
            if (xml.evaluate) {
                //récupération des nodes via le path et le fichier xml
                var nodes = xml.evaluate(path, xml, null, XPathResult.ANY_TYPE, null);
                //récupération de la première itération
                var result = nodes.iterateNext();
                //récupération de la valeur du premier titre
                tmpString += result.childNodes[0].nodeValue;
            }
            //si IE
            else if (window.ActiveXObject || xhttp.responseType == "msxml-document") {
                //définition de la propriété SelectionLanguage
                xml.setProperty("SelectionLanguage", "XPath");
                //récupération des nodes via le path et le fichier xml
                nodes = xml.selectNodes(path);
                //récupération de la valeur du premier titre
                tmpString += result.childNodes[0].nodeValue;
            }
            //affichage du résultat
            console.log("Titre du premier film de la liste");
            console.log(tmpString);
            document.getElementById("firstFilm").innerHTML = tmpString;

            //création d'un path pour vers la racine du document
            path = "lesfilms";
            //reset de la chaine
            tmpString = "";

            //si le xml existe et est correct
            if (xml.evaluate) {
                //récupération des nodes via le path et le fichier xml
                var nodes = xml.evaluate(path, xml, null, XPathResult.ANY_TYPE, null);
                //récupération de la première itération
                var result = nodes.iterateNext();
                //récupération de la valeur du dernier titre
                tmpString += result.lastElementChild.childNodes[1].textContent;
            }
            //si IE
            else if (window.ActiveXObject || xhttp.responseType == "msxml-document") {
                //définition de la propriété SelectionLanguage
                xml.setProperty("SelectionLanguage", "XPath");
                //récupération des nodes via le path et le fichier xml
                nodes = xml.selectNodes(path);
                //récupération de la valeur du dernier titre
                tmpString += result.lastElementChild.childNodes[1].textContent;
            }
            //affichage du résultat
            console.log("Titre du dernier film de la liste");
            console.log(tmpString);
            document.getElementById("lastFilm").innerHTML = tmpString;

            //création d'un path cherchant les titre de film sortie après 1950
            path = "lesfilms/film[date>1950]/titre";
            //reset de la chaine
            tmpString = "";

            //si le xml existe et est correct
            if (xml.evaluate) {
                //récupération des nodes via le path et le fichier xml
                var nodes = xml.evaluate(path, xml, null, XPathResult.ANY_TYPE, null);
                //récupération de la première itération
                var result = nodes.iterateNext();
                //tant qu'il y a un résultat
                while (result) {
                    //ajout du titre à la chaine
                    tmpString += result.childNodes[0].nodeValue+"\n";
                    //passage à la prochaine itération
                    result = nodes.iterateNext();
                }
            }
            //si IE
            else if (window.ActiveXObject || xhttp.responseType == "msxml-document") {
                //définition de la propriété SelectionLanguage
                xml.setProperty("SelectionLanguage", "XPath");
                //récupération des nodes via le path et le fichier xml
                nodes = xml.selectNodes(path);
                //pour chaque résultat
                for (var i = 0; i < nodes.length; i++) {
                    //ajout du titre à la chaine
                    tmpString += result.childNodes[0].nodeValue+"<br/>";
                }
            }
            //affichage du résultat
            console.log("Liste des films sortie après 1950");
            console.log(tmpString);
            document.getElementById("titleList1950").innerHTML = tmpString;
        }


    </script>

    <!--footer-->
    <footer>
        <!--paragraphe de footer-->
        <p>Anthony LAMOUR étudiant en Master 2 à Ludus Académie</p>
    </footer>
</body>
</html>